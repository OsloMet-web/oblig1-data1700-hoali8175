<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Kunder</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<h1>Kunde</h1>
<form id="billettForm">
  <label for="filmNavn">Filmnavn:</label>
  <input type="text" id="filmNavn" required><br>
  <span id="filmNavnError" class="error-message"></span><br>

  <label for="antallBilletter">Antall billetter:</label>
  <input type="number" id="antallBilletter" min="1" max="9" required><br>
  <span id="antallBilletterError" class="error-message"></span><br>

  <label for="kundeNavn">Fornavn:</label>
  <input type="text" id="kundeNavn" required><br>
  <span id="kundeNavnError" class="error-message"></span><br>

  <label for="kundeEtternavn">Etternavn:</label>
  <input type="text" id="kundeEtternavn" required><br>
  <span id="kundeEtternavnError" class="error-message"></span><br>

  <label for="kundeNummer">Telefonnummer:</label>
  <input type="text" id="kundeNummer" pattern="[0-9]{8}" required><br>
  <span id="kundeNummerError" class="error-message"></span><br>

  <label for="kundeEmail">E-postadresse:</label>
  <input type="email" id="kundeEmail" required><br>
  <span id="kundeEmailError" class="error-message"></span><br>

  <button type="submit">Registrer</button>
</form>

<h2>Alle billetter:</h2>
<ul id="billettListe"></ul>

<button id="slettBilletter">Slett alle billettene</button>

<script>
  $(document).ready(function() {
    // Hent alle billetter n책r siden lastes
    hentAlleBilletter();

    // Lytt etter innlevering av skjemaet for kinobillettbestilling
    $('#billettForm').submit(function(event) {
      event.preventDefault();

      // Validering av inputfelter
      const isValid = validerInput();

      if (!isValid) {
        return;
      }

      const billettData = {
        filmNavn: $('#filmNavn').val(),
        antallBilletter: $('#antallBilletter').val(),
        kundeNavn: $('#kundeNavn').val(),
        kundeEtternavn: $('#kundeEtternavn').val(),
        kundeNummer: $('#kundeNummer').val(),
        kundeEmail: $('#kundeEmail').val()
      };

      $.post('/api/billetter/registrer', billettData, function() {
        hentAlleBilletter();
        $('#billettForm')[0].reset();
      });
    });

    // Lytt etter klikk p책 slett-knappen
    $('#slettBilletter').click(function() {
      $.ajax({
        url: '/api/billetter/slettAlle',
        type: 'DELETE',
        success: function() {
          $('#billettListe').empty();
        }
      });
    });

    // Funksjon for 책 hente alle billetter
    function hentAlleBilletter() {
      $.get('/api/billetter/hentAlle', function(data) {
        $('#billettListe').empty();
        data.forEach(function(billett) {
          const ut = `<li>Filmnavn: ${billett.filmNavn}, Antall: ${billett.antallBilletter}, Kunde: ${billett.kundeNavn} ${billett.kundeEtternavn}, Telefon: ${billett.kundeNummer}, E-post: ${billett.kundeEmail}</li>`;
          $('#billettListe').append(ut);
        });
      });
    }

    // Funksjon for 책 validere inputfelter
    function validerInput() {
      let isValid = true;

      // Validering av filmnavn
      const filmNavn = $('#filmNavn').val().trim();
      if (filmNavn === '') {
        $('#filmNavnError').text('Vennligst velg en film');
        isValid = false;
      }
      else {
        $('#filmNavnError').text('');
      }
      // Validering av antall billetter
      const antallBilletter = $('#antallBilletter').val();
      if (isNaN(antallBilletter) || antallBilletter < 1 || antallBilletter > 9) {
        $('#antallBilletterError').text('Vennligst oppgi et gyldig antall billetter (mellom 1 og 9)');
        isValid = false;
      } else {
        $('#antallBilletterError').text('');
      }

      // Validering av fornavn
      const kundeNavn = $('#kundeNavn').val().trim();
      if (kundeNavn === '') {
        $('#kundeNavnError').text('Vennligst oppgi navnet ditt');
        isValid = false;
      } else {
        $('#kundeNavnError').text('');
      }

      // Validering av etternavn
      const kundeEtternavn = $('#kundeEtternavn').val().trim();
      if (kundeEtternavn === '') {
        $('#kundeEtternavnError').text('Vennligst oppgi etternavnet ditt');
        isValid = false;
      } else {
        $('#kundeEtternavnError').text('');
      }

      // Validering av telefonnummer
      const telefonnummer = $('#kundeNummer').val().trim();
      const telefonRegex = /^\d{8}$/;
      if (!telefonRegex.test(telefonnummer)) {
        $('#kundeNummerError').text('Vennligst oppgi et gyldig telefonnummer med 8 sifre');
        isValid = false;
      } else {
        $('#kundeNummerError').text('');
      }

      // Validering av e-postadresse
      const kundeEmail = $('#kundeEmail').val().trim();
      const emailRegex = /^\S+@\S+\.\S+$/;
      if (!emailRegex.test(kundeEmail)) {
        $('#kundeEmailError').text('Vennligst oppgi en gyldig e-postadresse');
        isValid = false;
      } else {
        $('#kundeEmailError').text('');
      }

      return isValid;
    }
  });
</script>
</body>
</html>
