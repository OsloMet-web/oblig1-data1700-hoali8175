<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OBLIG 2</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
</head>
<body>

<h1>Bestilling av kinobiletter-OBLIG2</h1>

<!-- Skjema for kinobillettbestilling -->
<form id="billettForm">
  <table>
    <!-- Filmnavn -->
    <tr>
      <td><label for="filmNavn">Filmnavn:</label></td>
      <td>
        <select class="form-control" id="filmNavn">
          <option value="" selected disabled>Velg film her</option>
          <option>Indiana Jones and the Dial of Destiny</option>
          <option>Avengers Infinity War</option>
          <option>Spiderman Far From Home</option>
        </select>
        <span id="filmNavnError" class="error-message"></span>
      </td>
    </tr>
    <!-- Antall billetter -->
    <tr>
      <td><label for="antallBilletter">Antall billetter:</label></td>
      <td>
        <input type="number" id="antallBilletter" min="1" max="9">
        <span id="antallBilletterError" class="error-message"></span>
      </td>
    </tr>
    <!-- Fornavn -->
    <tr>
      <td><label for="kundeNavn">Fornavn:</label></td>
      <td>
        <input class="form-control" type="text" id="kundeNavn">
        <span id="kundeNavnError" class="error-message"></span>
      </td>
    </tr>
    <!-- Etternavn -->
    <tr>
      <td><label for="kundeEtternavn">Etternavn:</label></td>
      <td>
        <input class="form-control" type="text" id="kundeEtternavn">
        <span id="kundeEtternavnError" class="error-message"></span>
      </td>
    </tr>
    <!-- Telefonnummer -->
    <tr>
      <td><label for="kundeNummer">Telefonnummer:</label></td>
      <td>
        <input class="form-control" type="text" id="kundeNummer">
        <span id="kundeNummerError" class="error-message"></span>
      </td>
    </tr>
    <!-- E-postadresse -->
    <tr>
      <td><label for="kundeEmail">E-postadresse:</label></td>
      <td>
        <input class="form-control" type="text" id="kundeEmail">
        <span id="kundeEmailError" class="error-message"></span>
      </td>
    </tr>
  </table>
  <!-- Knapp for å sende inn skjemaet -->
  <button class="btn btn-primary" type="submit">Kjøp billett</button>
</form>

<!-- Overskrift for alle billetter -->
<h2>Alle billetter:</h2>
<!-- Liste for å vise alle billetter -->
<ul id="billettListe"></ul>

<!-- Knapp for å slette alle billetter -->
<button class="btn btn-danger" id="slettBilletter">Slett alle billettene</button>


<script>
  $(document).ready(function() {
    // Hent alle billetter når siden lastes
    hentAlleBilletter();

    // Lytt etter innlevering av skjemaet for kinobillettbestilling
    $('#billettForm').submit(function(event) {
      event.preventDefault();

      // Validering av inputfelter
      const isValid = validerInput();

      if (!isValid) {
        return;
      }

      const billettData = {
        filmNavn: $('#filmNavn').val(),
        antallBilletter: $('#antallBilletter').val(),
        kundeNavn: $('#kundeNavn').val(),
        kundeEtternavn: $('#kundeEtternavn').val(),
        kundeNummer: $('#kundeNummer').val(),
        kundeEmail: $('#kundeEmail').val()
      };

      $.post('/api/billetter/registrer', billettData, function() {
        hentAlleBilletter();
        $('#billettForm')[0].reset();
      });
    });

    // Lytt etter klikk på slett-knappen
    $('#slettBilletter').click(function() {
      $.ajax({
        url: '/api/billetter/slettAlle',
        type: 'DELETE',
        success: function() {
          $('#billettListe').empty();
        }
      });
    });

    // Funksjon for å hente alle billetter
    function hentAlleBilletter() {
      $.get('/api/billetter/hentAlle', function(data) {
        $('#billettListe').empty();
        data.forEach(function(billett) {
          const ut = `<li>Filmnavn: ${billett.filmNavn}, Antall: ${billett.antallBilletter}, Kunde: ${billett.kundeNavn} ${billett.kundeEtternavn}, Telefon: ${billett.kundeNummer}, E-post: ${billett.kundeEmail}</li>`;
          $('#billettListe').append(ut);
        });
      });
    }

    // Funksjon for å validere inputfelter
    function validerInput() {
      let isValid = true;

      // Validering av filmnavn
      const filmNavn = $('#filmNavn').val().trim();
      if (filmNavn === '') {
        $('#filmNavnError').text('Vennligst velg en film');
        isValid = false;
      }
      else {
        $('#filmNavnError').text('');
      }
      // Validering av antall billetter
      const antallBilletter = $('#antallBilletter').val();
      if (isNaN(antallBilletter) || antallBilletter < 1 || antallBilletter > 9) {
        $('#antallBilletterError').text('Vennligst oppgi et gyldig antall billetter (mellom 1 og 9)');
        isValid = false;
      } else {
        $('#antallBilletterError').text('');
      }

      // Validering av fornavn
      const kundeNavn = $('#kundeNavn').val().trim();
      if (kundeNavn === '') {
        $('#kundeNavnError').text('Vennligst oppgi navnet ditt');
        isValid = false;
      } else {
        $('#kundeNavnError').text('');
      }

      // Validering av etternavn
      const kundeEtternavn = $('#kundeEtternavn').val().trim();
      if (kundeEtternavn === '') {
        $('#kundeEtternavnError').text('Vennligst oppgi etternavnet ditt');
        isValid = false;
      } else {
        $('#kundeEtternavnError').text('');
      }

      // Validering av telefonnummer
      const telefonnummer = $('#kundeNummer').val().trim();
      const telefonRegex = /^\d{8}$/;
      if (!telefonRegex.test(telefonnummer)) {
        $('#kundeNummerError').text('Vennligst oppgi et gyldig telefonnummer med 8 sifre');
        isValid = false;
      } else {
        $('#kundeNummerError').text('');
      }

      // Validering av e-postadresse
      const kundeEmail = $('#kundeEmail').val().trim();
      const emailRegex = /^\S+@\S+\.\S+$/;
      if (!emailRegex.test(kundeEmail)) {
        $('#kundeEmailError').text('Vennligst oppgi en gyldig e-postadresse');
        isValid = false;
      } else {
        $('#kundeEmailError').text('');
      }

      return isValid;
    }
  });
</script>
</body>
</html>
